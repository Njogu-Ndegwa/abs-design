<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Oves | Station App</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Core Styles -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- Module Styles -->
    <link rel="stylesheet" href="css/modules/splash.css">
    <link rel="stylesheet" href="css/modules/onboarding.css">
    <link rel="stylesheet" href="css/modules/roles.css">
    <link rel="stylesheet" href="css/modules/login.css">
    <link rel="stylesheet" href="css/modules/cards.css">
    <link rel="stylesheet" href="css/modules/attendant.css">
    <link rel="stylesheet" href="css/modules/sales.css">
    <link rel="stylesheet" href="css/modules/session.css">
    <link rel="stylesheet" href="css/modules/rider.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <img src="assets/Logo-Oves.png" alt="Oves" class="logo-img">
            </div>
            <div class="header-right">
                <div class="status-badge" id="statusBadge">
                    <span class="status-dot"></span>
                    Online
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- ==================== -->
        <!-- SPLASH SCREEN        -->
        <!-- ==================== -->
        <div class="splash" id="splash-screen">
            <div class="splash-content">
                <!-- Battery Swap Animation -->
                <div class="splash-animation">
                    <!-- Swap arrows coming down -->
                    <div class="splash-arrows">
                        <svg class="splash-arrow" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 4l-8 8h5v8h6v-8h5z"/>
                        </svg>
                        <svg class="splash-arrow" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 4l-8 8h5v8h6v-8h5z"/>
                        </svg>
                        <svg class="splash-arrow" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 4l-8 8h5v8h6v-8h5z"/>
                        </svg>
                    </div>
                    
                    <!-- Battery with charging animation -->
                    <div class="splash-battery">
                        <div class="splash-battery-fill"></div>
                    </div>
                    
                    <!-- Floating energy particles -->
                    <div class="splash-particles">
                        <div class="splash-particle"></div>
                        <div class="splash-particle"></div>
                        <div class="splash-particle"></div>
                        <div class="splash-particle"></div>
                    </div>
                </div>

                <img src="assets/Logo-Oves.png" alt="Omnivoltaic" class="splash-logo-img">
                
                <div class="splash-loading">
                    <span>Loading</span>
                    <div class="splash-loading-dots">
                        <div class="splash-loading-dot"></div>
                        <div class="splash-loading-dot"></div>
                        <div class="splash-loading-dot"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== -->
        <!-- ONBOARDING MODULE    -->
        <!-- ==================== -->
        <div class="module" id="module-onboarding">
            <main class="main no-padding-bottom">
                <div class="onboarding">
                    <div class="onboarding-slides">
                        <!-- Slide 1: Attendant -->
                        <div class="onboarding-slide active" data-slide="0">
                            <div class="onboarding-image">
                                <img src="assets/Attendant.png" alt="Swap Attendant">
                            </div>
                            <div class="onboarding-content">
                                <h2 class="onboarding-title">Swap Attendant</h2>
                                <p class="onboarding-desc">Process battery swaps quickly and efficiently. Scan batteries, verify customer ownership, and confirm payments in seconds.</p>
                            </div>
                        </div>

                        <!-- Slide 2: Sales Rep -->
                        <div class="onboarding-slide" data-slide="1">
                            <div class="onboarding-image">
                                <img src="assets/Sales.png" alt="Sales Representative">
                            </div>
                            <div class="onboarding-content">
                                <h2 class="onboarding-title">Sales Representative</h2>
                                <p class="onboarding-desc">Register new customers, set up subscription plans, and assign batteries. Grow the network one rider at a time.</p>
                            </div>
                        </div>

                        <!-- Slide 3: Rider -->
                        <div class="onboarding-slide" data-slide="2">
                            <div class="onboarding-image">
                                <img src="assets/Rider.png" alt="Rider">
                            </div>
                            <div class="onboarding-content">
                                <h2 class="onboarding-title">Rider App</h2>
                                <p class="onboarding-desc">Self-service battery swapping for riders. Find nearby stations, check battery status, and swap on the go.</p>
                            </div>
                        </div>

                        <!-- Slide 4: Keypad -->
                        <div class="onboarding-slide" data-slide="3">
                            <div class="onboarding-image">
                                <img src="assets/Keypad.png" alt="Keypad">
                            </div>
                            <div class="onboarding-content">
                                <h2 class="onboarding-title">Keypad</h2>
                                <p class="onboarding-desc">Enter codes to interact with Oves BLE devices. A universal interface for authentication and device access across the network.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="onboarding-dots">
                        <div class="onboarding-dot active" onclick="goToSlide(0)"></div>
                        <div class="onboarding-dot" onclick="goToSlide(1)"></div>
                        <div class="onboarding-dot" onclick="goToSlide(2)"></div>
                        <div class="onboarding-dot" onclick="goToSlide(3)"></div>
                    </div>

                    <!-- Actions -->
                    <div class="onboarding-actions">
                        <button class="btn btn-primary" id="onboarding-next-btn" onclick="nextSlide()">
                            <span id="onboarding-btn-text">Next</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>

                    <div class="onboarding-skip">
                        <button onclick="skipOnboarding()">Skip intro</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- ==================== -->
        <!-- ROLE SELECTION MODULE -->
        <!-- ==================== -->
        <div class="module" id="module-roles">
            <main class="main no-padding-bottom">
                <div class="role-selection">
                    <!-- Hero Section with Bikes -->
                    <div class="role-hero">
                        <div class="role-hero-image">
                            <img src="assets/Bikes Oves.png" alt="Electric Bikes">
                        </div>
                        <!-- Atmospheric cloud/mist effect -->
                        <div class="role-hero-atmosphere"></div>
                        <div class="role-hero-mist"></div>
                        <div class="role-hero-reflect"></div>
                    </div>

                    <!-- Title Section -->
                    <div class="role-header">
                        <h1 class="role-title">Select Your Role</h1>
                        <p class="role-description">
                            Choose <strong>your role</strong> to access the right tools for your daily tasks.
                        </p>
                    </div>

                    <!-- Applet Grid -->
                    <div class="role-grid">
                        <!-- Swap Attendant -->
                        <div class="role-applet" onclick="toggleRoleSelection(this, 'attendant')" data-role="attendant">
                            <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            <div class="role-applet-image">
                                <img src="assets/Attendant.png" alt="Swap Attendant">
                            </div>
                            <span class="role-applet-label">Attendant</span>
                        </div>

                        <!-- Sales Rep -->
                        <div class="role-applet" onclick="toggleRoleSelection(this, 'sales')" data-role="sales">
                            <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            <div class="role-applet-image">
                                <img src="assets/Sales.png" alt="Sales Rep">
                            </div>
                            <span class="role-applet-label">Sales Rep</span>
                        </div>

                        <!-- Station Manager -->
                        <div class="role-applet disabled" onclick="toggleRoleSelection(this, 'manager')" data-role="manager">
                            <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            <div class="role-applet-image">
                                <img src="assets/Keypad.png" alt="Station Manager">
                            </div>
                            <span class="role-applet-label">Manager</span>
                            <span class="role-applet-badge">Coming Soon</span>
                        </div>

                        <!-- Rider -->
                        <div class="role-applet" onclick="toggleRoleSelection(this, 'rider')" data-role="rider">
                            <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            <div class="role-applet-image">
                                <img src="assets/Rider.png" alt="Rider">
                            </div>
                            <span class="role-applet-label">Rider</span>
                        </div>
                    </div>

                    <!-- Action Button -->
                    <div class="role-action">
                        <button class="btn btn-primary" id="role-continue-btn" onclick="proceedWithRole()" disabled>
                            <span>Continue</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- ==================== -->
        <!-- LOGIN MODULE         -->
        <!-- ==================== -->
        <div class="module" id="module-login">
            <main class="main no-padding-bottom">
                <!-- Back to Roles -->
                <div class="back-to-roles" onclick="backToRoles()" style="position: absolute; top: 10px; left: 16px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back
                </div>
                
                <div class="login-container">
                    <!-- Login Header -->
                    <div class="login-header">
                        <div class="login-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <h1 class="login-title" id="login-title">Staff Login</h1>
                        <p class="login-subtitle" id="login-subtitle">Sign in to access your workspace</p>
                    </div>

                    <!-- Login Form -->
                    <div class="login-form">
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <div class="input-with-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="4" width="20" height="16" rx="2"/>
                                    <path d="M22 6l-10 7L2 6"/>
                                </svg>
                                <input type="email" class="form-input" id="login-email" placeholder="yourname@oves.com">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">PIN</label>
                            <div class="input-with-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                                <input type="password" class="form-input" id="login-pin" placeholder="••••" maxlength="4" inputmode="numeric">
                            </div>
                        </div>

                        <button class="btn btn-primary login-btn" onclick="handleLogin()">
                            <span>Sign In</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </button>

                        <p class="login-help">
                            Forgot PIN? Contact your supervisor
                        </p>
                    </div>

                    <!-- Current User Info (shown when logged in before) -->
                    <div class="logged-in-info hidden" id="logged-in-info">
                        <div class="logged-user-card">
                            <div class="logged-user-avatar" id="logged-user-avatar">JM</div>
                            <div class="logged-user-details">
                                <div class="logged-user-name" id="logged-user-name">James Mwangi</div>
                                <div class="logged-user-role" id="logged-user-role">Swap Attendant</div>
                            </div>
                            <span class="logged-user-badge">Active</span>
                        </div>
                        <button class="btn btn-primary login-btn" onclick="continueAsUser()">
                            <span>Continue</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </button>
                        <button class="btn btn-secondary switch-user-btn" onclick="switchUser()">
                            Switch Account
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- ==================== -->
        <!-- ATTENDANT MODULE     -->
        <!-- ==================== -->
        <div class="module" id="module-attendant">
            <!-- Back to Roles - At very top -->
            <div style="display: flex; align-items: center; justify-content: space-between; margin: 0 16px 8px;">
                <div class="back-to-roles" onclick="backToRoles()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Change Role
                </div>
                <button class="session-search-btn" onclick="openSessionModal('attendant')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                    Sessions
                </button>
            </div>
            
            <!-- Session Mode Indicator -->
            <div class="session-mode-indicator" id="att-session-indicator">
                <div class="session-mode-badge active" id="att-session-badge">
                    <span id="att-session-mode-text">New Session</span>
                </div>
                <div class="session-mode-info" id="att-session-info">
                    Session: <strong id="att-session-id">--</strong>
                </div>
                <button class="session-mode-close" onclick="exitSessionMode('attendant')" id="att-session-close" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Session Choice Prompt (Resume vs Start Fresh) -->
            <div class="session-choice-prompt" id="att-session-choice">
                <div class="session-choice-header">
                    <div class="session-choice-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                            <path d="M3 3v5h5"/>
                        </svg>
                    </div>
                    <div class="session-choice-text">
                        <h4>Previous Session Found</h4>
                        <p>Customer <strong id="att-choice-customer-id">--</strong> at step <strong id="att-choice-step">--</strong> of 6</p>
                    </div>
                </div>
                <div class="session-choice-actions">
                    <button class="session-choice-btn secondary" onclick="startFreshSession('attendant')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        Start Fresh
                    </button>
                    <button class="session-choice-btn primary" onclick="resumePendingSession('attendant')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Resume
                    </button>
                </div>
            </div>

            <!-- Interactive Timeline - 6 steps -->
            <div class="flow-timeline" id="att-timeline">
                <div class="timeline-track">
                    <!-- Step 1: Customer -->
                    <div class="timeline-step active" data-step="1" onclick="attTimelineClick(1)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Customer</span>
                    </div>
                    <div class="timeline-connector" data-after="1"></div>
                    
                    <!-- Step 2: Old Battery -->
                    <div class="timeline-step disabled" data-step="2" onclick="attTimelineClick(2)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="7" width="16" height="10" rx="2"/>
                                <path d="M22 11v2"/>
                                <path d="M6 11v2"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Return</span>
                    </div>
                    <div class="timeline-connector" data-after="2"></div>
                    
                    <!-- Step 3: New Battery -->
                    <div class="timeline-step disabled" data-step="3" onclick="attTimelineClick(3)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="7" width="16" height="10" rx="2"/>
                                <path d="M22 11v2"/>
                                <path d="M7 11h4M9 9v4"/>
                            </svg>
                        </div>
                        <span class="timeline-label">New</span>
                    </div>
                    <div class="timeline-connector" data-after="3"></div>
                    
                    <!-- Step 4: Review -->
                    <div class="timeline-step disabled" data-step="4" onclick="attTimelineClick(4)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <path d="M14 2v6h6"/>
                                <path d="M16 13H8M16 17H8"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Review</span>
                    </div>
                    <div class="timeline-connector" data-after="4"></div>
                    
                    <!-- Step 5: Payment -->
                    <div class="timeline-step disabled" data-step="5" onclick="attTimelineClick(5)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="1" y="4" width="22" height="16" rx="2"/>
                                <path d="M1 10h22"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Pay</span>
                    </div>
                    <div class="timeline-connector" data-after="5"></div>
                    
                    <!-- Step 6: Done -->
                    <div class="timeline-step disabled" data-step="6" onclick="attTimelineClick(6)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Done</span>
                    </div>
                </div>
            </div>

            <!-- Customer State Panel - Fixed/Sticky after identification -->
            <div class="customer-state-panel" id="att-customer-state">
                <div class="customer-state-inner">
                    <!-- Customer Identity -->
                    <div class="state-customer">
                        <div class="state-avatar" id="state-avatar">JM</div>
                        <div class="state-customer-info">
                            <div class="state-customer-name" id="state-customer-name">James Mwangi</div>
                            <div class="state-plan-row">
                                <span class="state-plan-name" id="state-plan-name">7-Day Lux</span>
                                <span class="state-badge active" id="state-status-badge">Active</span>
                                <span class="state-badge current" id="state-payment-badge">Current</span>
                            </div>
                        </div>
                    </div>
                    <!-- Current Battery -->
                    <div class="state-battery" id="state-current-battery">
                        <div class="state-battery-icon">
                            <div class="state-battery-fill" style="--level: 100%;"></div>
                        </div>
                        <span class="state-battery-id" id="state-battery-id">BAT_004</span>
                    </div>
                </div>
            </div>
            
            <!-- Quota Summary - Separate cards below customer panel -->
            <div class="state-quotas" id="state-quotas">
                <!-- Energy Quota -->
                <div class="state-quota-item" id="state-quota-energy">
                    <div class="state-quota-icon energy">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <div class="state-quota-info">
                        <div class="state-quota-value">
                            <span class="remaining" id="state-energy-remaining">62</span>
                            <span class="unit">kWh left</span>
                        </div>
                        <div class="state-quota-bar">
                            <div class="state-quota-fill good" id="state-energy-fill" style="width: 11.4%;"></div>
                        </div>
                    </div>
                </div>
                <!-- Swaps Quota -->
                <div class="state-quota-item" id="state-quota-swaps">
                    <div class="state-quota-icon swaps">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M7 16V4m0 0L3 8m4-4l4 4M17 8v12m0 0l4-4m-4 4l-4-4"/>
                        </svg>
                    </div>
                    <div class="state-quota-info">
                        <div class="state-quota-value">
                            <span class="remaining" id="state-swaps-remaining">18</span>
                            <span class="unit">swaps left</span>
                        </div>
                        <div class="state-quota-bar">
                            <div class="state-quota-fill good" id="state-swaps-fill" style="width: 14.3%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <main class="main">
                <!-- Screen 1: Identify Customer -->
                <div class="screen active" id="att-screen-customer">
                    <div class="scan-prompt">
                        <h1 class="scan-title">Identify Customer</h1>
                        
                        <!-- Toggle between Scan and Manual -->
                        <div class="input-toggle">
                            <button class="toggle-btn active" id="toggle-scan" onclick="toggleCustomerInput('scan')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"/>
                                    <rect x="14" y="3" width="7" height="7"/>
                                    <rect x="14" y="14" width="7" height="7"/>
                                    <rect x="3" y="14" width="7" height="7"/>
                                </svg>
                                Scan QR
                            </button>
                            <button class="toggle-btn" id="toggle-manual" onclick="toggleCustomerInput('manual')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                </svg>
                                Enter ID
                            </button>
                        </div>
                        
                        <!-- Scan QR Option -->
                        <div class="customer-input-mode" id="customer-scan-mode">
                            <p class="scan-subtitle">Scan customer's QR code</p>
                            
                            <div class="scanner-area" onclick="attScanCustomer()">
                                <div class="scanner-frame">
                                    <div class="scanner-corners">
                                        <div class="scanner-corner-bl"></div>
                                        <div class="scanner-corner-br"></div>
                                    </div>
                                    <div class="scanner-line"></div>
                                    <div class="scanner-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="3" width="7" height="7"/>
                                            <rect x="14" y="3" width="7" height="7"/>
                                            <rect x="14" y="14" width="7" height="7"/>
                                            <rect x="3" y="14" width="7" height="7"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="scan-hint">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                Customer shows their app QR code
                            </p>
                        </div>
                        
                        <!-- Manual Entry Option -->
                        <div class="customer-input-mode hidden" id="customer-manual-mode">
                            <p class="scan-subtitle">Enter Subscription ID manually</p>
                            
                            <div class="manual-entry-form">
                                <div class="form-group">
                                    <label class="form-label">Subscription ID</label>
                                    <input type="text" class="form-input manual-id-input" id="subscriptionId" placeholder="e.g. SUB-8847-KE" autocomplete="off">
                                </div>
                                <button class="btn btn-primary" onclick="attLookupCustomer()" style="width: 100%; margin-top: 8px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="M21 21l-4.35-4.35"/>
                                    </svg>
                                    Look Up Customer
                                </button>
                            </div>
                            
                            <p class="scan-hint">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                Find ID on customer's account or receipt
                            </p>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-value">24</div>
                            <div class="stat-label">Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">156</div>
                            <div class="stat-label">This Week</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">98%</div>
                            <div class="stat-label">Success</div>
                        </div>
                    </div>
                </div>

                <!-- Screen 2: Scan Old Battery -->
                <div class="screen" id="att-screen-oldbattery">
                    <div class="scan-prompt">
                        <h1 class="scan-title">Scan Old Battery</h1>
                        <p class="scan-subtitle">Scan the battery the customer brought in</p>
                        
                        <div class="scanner-area" onclick="attScanOldBattery()" style="margin: 12px auto;">
                            <div class="scanner-frame">
                                <div class="scanner-corners">
                                    <div class="scanner-corner-bl"></div>
                                    <div class="scanner-corner-br"></div>
                                </div>
                                <div class="scanner-line"></div>
                                <div class="scanner-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                                        <path d="M7 7h.01M7 12h.01M7 17h.01M12 7h.01M12 12h.01M12 17h.01M17 7h.01M17 12h.01M17 17h.01"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <p class="scan-hint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            Verify battery belongs to customer
                        </p>
                    </div>
                </div>

                <!-- Screen 3: Scan New Battery -->
                <div class="screen" id="att-screen-newbattery">
                    <!-- Compact Old Battery Card -->
                    <div class="battery-return-card">
                        <div class="battery-return-header">
                            <span class="battery-return-label">OLD BATTERY</span>
                            <span class="battery-return-status">Matched</span>
                        </div>
                        <div class="battery-return-content">
                            <div class="battery-return-id">BAT-2024-7829</div>
                            <div class="battery-return-charge">
                                <div class="battery-return-icon low">
                                    <div class="battery-return-fill" style="--level: 35%;"></div>
                                </div>
                                <span class="battery-return-percent">35%</span>
                                <span class="battery-return-unit">Charge</span>
                            </div>
                        </div>
                    </div>

                    <div class="scan-prompt">
                        <h1 class="scan-title">Scan New Battery</h1>
                        <p class="scan-subtitle">Scan the fresh battery to give customer</p>
                        
                        <div class="scanner-area" onclick="attScanNewBattery()" style="margin: 12px auto;">
                            <div class="scanner-frame">
                                <div class="scanner-corners">
                                    <div class="scanner-corner-bl"></div>
                                    <div class="scanner-corner-br"></div>
                                </div>
                                <div class="scanner-line"></div>
                                <div class="scanner-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                                        <path d="M7 7h.01M7 12h.01M7 17h.01M12 7h.01M12 12h.01M12 17h.01M17 7h.01M17 12h.01M17 17h.01"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screen 4: Review & Cost -->
                <div class="screen" id="att-screen-review">
                    <!-- Visual Battery Comparison -->
                    <div class="battery-swap-visual">
                        <div class="battery-swap-item">
                            <div class="battery-icon-swap low">
                                <div class="battery-level-swap" style="--level: 35%;"></div>
                                <span class="battery-percent">35%</span>
                            </div>
                            <div class="battery-swap-label">RETURNING</div>
                            <div class="battery-swap-id">BAT-7829</div>
                        </div>
                        
                        <div class="swap-arrow-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </div>
                        
                        <div class="battery-swap-item">
                            <div class="battery-icon-swap full">
                                <div class="battery-level-swap" style="--level: 100%;"></div>
                                <span class="battery-percent">100%</span>
                            </div>
                            <div class="battery-swap-label">RECEIVING</div>
                            <div class="battery-swap-id">BAT-3156</div>
                        </div>
                    </div>

                    <!-- Energy Differential Badge -->
                    <div class="energy-diff-badge">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <span>+1.63 kWh</span>
                    </div>

                    <div class="cost-card">
                        <div class="cost-title">Cost Breakdown</div>
                        <div class="cost-row">
                            <span class="cost-label">Energy Received</span>
                            <span class="cost-value">1.63 kWh</span>
                        </div>
                        <div class="cost-row">
                            <span class="cost-label">Rate</span>
                            <span class="cost-value">XOF 565/kWh</span>
                        </div>
                        <div class="cost-total">
                            <span class="cost-total-label">Total Due</span>
                            <span class="cost-total-value">XOF 920</span>
                        </div>
                    </div>
                </div>

                <!-- Screen 5: Confirm Payment -->
                <div class="screen" id="att-screen-payment">
                    <div class="cost-card" style="margin-bottom: 8px;">
                        <div class="cost-total" style="margin-top: 0;">
                            <span class="cost-total-label">Amount to Collect</span>
                            <span class="cost-total-value">XOF 920</span>
                        </div>
                    </div>

                    <div class="payment-scan">
                        <h2 class="payment-title">Confirm Payment</h2>
                        
                        <!-- Toggle between Scan and Manual -->
                        <div class="input-toggle">
                            <button class="toggle-btn active" id="toggle-payment-scan" onclick="togglePaymentInput('scan')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"/>
                                    <rect x="14" y="3" width="7" height="7"/>
                                    <rect x="14" y="14" width="7" height="7"/>
                                    <rect x="3" y="14" width="7" height="7"/>
                                </svg>
                                Scan QR
                            </button>
                            <button class="toggle-btn" id="toggle-payment-manual" onclick="togglePaymentInput('manual')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                </svg>
                                Enter ID
                            </button>
                        </div>
                        
                        <!-- Scan QR Option -->
                        <div class="payment-input-mode" id="payment-scan-mode">
                            <p class="payment-subtitle">Scan customer's QR after payment</p>
                            
                            <div class="qr-scanner-area" onclick="attConfirmPayment()">
                                <div class="qr-scanner-frame">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="7" height="7"/>
                                        <rect x="14" y="3" width="7" height="7"/>
                                        <rect x="14" y="14" width="7" height="7"/>
                                        <rect x="3" y="14" width="7" height="7"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="payment-amount">XOF 920</div>
                            <div class="payment-status">Tap to scan customer QR</div>
                        </div>
                        
                        <!-- Manual Entry Option -->
                        <div class="payment-input-mode hidden" id="payment-manual-mode">
                            <p class="payment-subtitle">Enter payment transaction ID</p>
                            
                            <div class="manual-entry-form">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label class="form-label">Payment / Transaction ID</label>
                                    <input type="text" class="form-input manual-id-input" id="paymentId" placeholder="e.g. TXN-892741 or M-PESA code" autocomplete="off">
                                </div>
                                <button class="btn btn-primary" onclick="attLookupPayment()" style="width: 100%; margin-top: 8px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 6L9 17l-5-5"/>
                                    </svg>
                                    Confirm Payment
                                </button>
                            </div>
                            
                            <div class="payment-amount" style="margin-top: 8px;">XOF 920</div>
                            <p class="scan-hint" style="margin-top: 4px;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                Enter M-PESA code or receipt number
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Screen 6: Success -->
                <div class="screen" id="att-screen-success">
                    <div class="success-screen">
                        <div class="success-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <h2 class="success-title">Swap Complete!</h2>
                        <p class="success-message">Hand over BAT-2024-3156 to customer</p>
                        
                        <div class="receipt-card">
                            <div class="receipt-header">
                                <span class="receipt-title">Transaction Receipt</span>
                                <span class="receipt-id">#TXN-892741</span>
                            </div>
                            <div class="receipt-row">
                                <span class="receipt-label">Customer</span>
                                <span class="receipt-value">James Mwangi</span>
                            </div>
                            <div class="receipt-row">
                                <span class="receipt-label">Returned</span>
                                <span class="receipt-value">BAT-2024-7829 (35%)</span>
                            </div>
                            <div class="receipt-row">
                                <span class="receipt-label">Issued</span>
                                <span class="receipt-value">BAT-2024-3156 (100%)</span>
                            </div>
                            <div class="receipt-row">
                                <span class="receipt-label">Energy</span>
                                <span class="receipt-value">1.63 kWh</span>
                            </div>
                            <div class="receipt-row">
                                <span class="receipt-label">Amount Paid</span>
                                <span class="receipt-value" style="color: var(--success);">XOF 920</span>
                            </div>
                            <div class="receipt-row">
                                <span class="receipt-label">Time</span>
                                <span class="receipt-value">14:32:07</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Attendant Action Bar -->
            <div class="action-bar">
                <div class="action-bar-inner">
                    <button class="btn btn-secondary hidden" id="att-btn-back" onclick="attGoBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Back
                    </button>
                    <button class="btn btn-primary" id="att-btn-main" onclick="attHandleMainAction()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="att-btn-icon">
                            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        <span id="att-btn-text">Scan Customer</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== -->
        <!-- SALES REP MODULE     -->
        <!-- ==================== -->
        <div class="module" id="module-sales">
            <!-- Back to Roles - At very top -->
            <div style="display: flex; align-items: center; justify-content: space-between; margin: 0 16px 8px;">
                <div class="back-to-roles" onclick="backToRoles()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Change Role
                </div>
                <button class="session-search-btn" onclick="openSessionModal('sales')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                    Sessions
                </button>
            </div>
            
            <!-- Session Mode Indicator -->
            <div class="session-mode-indicator" id="sales-session-indicator">
                <div class="session-mode-badge active" id="sales-session-badge">
                    <span id="sales-session-mode-text">New Session</span>
                </div>
                <div class="session-mode-info" id="sales-session-info">
                    Session: <strong id="sales-session-id">--</strong>
                </div>
                <button class="session-mode-close" onclick="exitSessionMode('sales')" id="sales-session-close" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Session Choice Prompt (Resume vs Start Fresh) -->
            <div class="session-choice-prompt" id="sales-session-choice">
                <div class="session-choice-header">
                    <div class="session-choice-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                            <path d="M3 3v5h5"/>
                        </svg>
                    </div>
                    <div class="session-choice-text">
                        <h4>Previous Session Found</h4>
                        <p>Customer <strong id="sales-choice-customer-id">--</strong> at step <strong id="sales-choice-step">--</strong> of 6</p>
                    </div>
                </div>
                <div class="session-choice-actions">
                    <button class="session-choice-btn secondary" onclick="startFreshSession('sales')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        Start Fresh
                    </button>
                    <button class="session-choice-btn primary" onclick="resumePendingSession('sales')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Resume
                    </button>
                </div>
            </div>

            <!-- Interactive Timeline - 6 steps -->
            <div class="flow-timeline" id="sales-timeline">
                <div class="timeline-track">
                    <!-- Step 1: Customer -->
                    <div class="timeline-step active" data-step="1" onclick="salesTimelineClick(1)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Customer</span>
                    </div>
                    <div class="timeline-connector" data-after="1"></div>
                    
                    <!-- Step 2: Product -->
                    <div class="timeline-step disabled" data-step="2" onclick="salesTimelineClick(2)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="7" cy="17" r="2"/>
                                <circle cx="17" cy="17" r="2"/>
                                <path d="M5 17H3v-6l2-4h9l4 4h3v6h-2"/>
                                <path d="M9 17h6"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Vehicle</span>
                    </div>
                    <div class="timeline-connector" data-after="2"></div>
                    
                    <!-- Step 3: Plan -->
                    <div class="timeline-step disabled" data-step="3" onclick="salesTimelineClick(3)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <path d="M14 2v6h6"/>
                                <path d="M16 13H8M16 17H8M10 9H8"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Plan</span>
                    </div>
                    <div class="timeline-connector" data-after="3"></div>
                    
                    <!-- Step 4: Payment -->
                    <div class="timeline-step disabled" data-step="4" onclick="salesTimelineClick(4)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="1" y="4" width="22" height="16" rx="2"/>
                                <path d="M1 10h22"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Payment</span>
                    </div>
                    <div class="timeline-connector" data-after="4"></div>
                    
                    <!-- Step 5: Battery -->
                    <div class="timeline-step disabled" data-step="5" onclick="salesTimelineClick(5)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="7" width="16" height="10" rx="2"/>
                                <path d="M22 11v2"/>
                                <path d="M7 11h4M9 9v4"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Battery</span>
                    </div>
                    <div class="timeline-connector" data-after="5"></div>
                    
                    <!-- Step 6: Done -->
                    <div class="timeline-step disabled" data-step="6" onclick="salesTimelineClick(6)">
                        <div class="timeline-dot">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Done</span>
                    </div>
                </div>
            </div>

            <main class="main">
                <!-- Screen 1: Customer Registration -->
                <div class="screen active" id="sales-screen-register">
                    <h2 class="scan-title" style="text-align: center; margin-bottom: 4px;">New Customer</h2>
                    <p class="scan-subtitle" style="text-align: center; margin-bottom: 12px;">Enter customer details to get started</p>

                    <div class="form-section">
                        <div class="form-section-title">Contact Information</div>
                        
                        <div class="form-group">
                            <label class="form-label">Customer Name</label>
                            <input type="text" class="form-input" id="customerName" placeholder="ABC Customer Ltd">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-input" id="customerEmail" placeholder="customer@example.com">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-input" id="customerPhone" placeholder="+254712345678">
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">Address</div>
                        
                        <div class="form-group">
                            <label class="form-label">Street Address</label>
                            <input type="text" class="form-input" id="customerStreet" placeholder="123 Main Street">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">City</label>
                                <input type="text" class="form-input" id="customerCity" placeholder="Nairobi">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ZIP Code</label>
                                <input type="text" class="form-input" id="customerZip" placeholder="00100">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screen 2: Select Product (Vehicle) -->
                <div class="screen" id="sales-screen-product">
                    <h2 class="scan-title" style="text-align: center; margin-bottom: 4px;">Select Vehicle</h2>
                    <p class="scan-subtitle" style="text-align: center; margin-bottom: 12px;">Choose the product to purchase</p>

                    <div class="vehicle-grid">
                        <div class="vehicle-card selected" onclick="selectVehicle(this, 'tuktuk2')">
                            <div class="vehicle-card-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <img src="assets/Tuk-2.png" alt="Tuk-Tuk" class="vehicle-image">
                            <div class="vehicle-info">
                                <div class="vehicle-name">Oves Tuk-Tuk</div>
                                <div class="vehicle-type">Electric Tuk-Tuk</div>
                                <div class="vehicle-price">XOF 1,175,000</div>
                            </div>
                        </div>

                        <div class="vehicle-card" onclick="selectVehicle(this, 'etrike')">
                            <div class="vehicle-card-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <img src="assets/E-3-one.png" alt="E-Trike" class="vehicle-image">
                            <div class="vehicle-info">
                                <div class="vehicle-name">E-Trike 3X</div>
                                <div class="vehicle-type">Electric Tricycle</div>
                                <div class="vehicle-price">XOF 565,000</div>
                            </div>
                        </div>

                        <div class="vehicle-card" onclick="selectVehicle(this, 'etrike-cargo')">
                            <div class="vehicle-card-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <img src="assets/F-3-one.png" alt="E-Trike Cargo" class="vehicle-image">
                            <div class="vehicle-info">
                                <div class="vehicle-name">E-Trike Cargo</div>
                                <div class="vehicle-type">Cargo Tricycle</div>
                                <div class="vehicle-price">XOF 680,000</div>
                            </div>
                        </div>

                        <div class="vehicle-card" onclick="selectVehicle(this, 'tuktuk')">
                            <div class="vehicle-card-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <img src="assets/Tuk-One.png" alt="Tuk-Tuk" class="vehicle-image">
                            <div class="vehicle-info">
                                <div class="vehicle-name">Oves Tuk-Tuk</div>
                                <div class="vehicle-type">Passenger Vehicle</div>
                                <div class="vehicle-price">XOF 1,315,000</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screen 3: Select Subscription -->
                <div class="screen" id="sales-screen-subscription">
                    <h2 class="scan-title" style="text-align: center; margin-bottom: 4px;">Battery Plan</h2>
                    <p class="scan-subtitle" style="text-align: center; margin-bottom: 12px;">Select battery subscription package</p>

                    <div class="product-grid">
                        <div class="product-card" onclick="selectPlan(this, 'daily')">
                            <div class="product-radio"></div>
                            <div class="product-info">
                                <div class="product-name">Daily Pass</div>
                                <div class="product-desc">Unlimited swaps for 24 hours</div>
                            </div>
                            <div class="product-price">
                                XOF 705
                                <span class="product-price-period">/day</span>
                            </div>
                        </div>

                        <div class="product-card selected" onclick="selectPlan(this, 'weekly')">
                            <div class="product-radio"></div>
                            <div class="product-info">
                                <div class="product-name">Weekly Plan</div>
                                <div class="product-desc">Unlimited swaps for 7 days</div>
                            </div>
                            <div class="product-price">
                                XOF 3,760
                                <span class="product-price-period">/week</span>
                            </div>
                        </div>

                        <div class="product-card" onclick="selectPlan(this, 'monthly')">
                            <div class="product-radio"></div>
                            <div class="product-info">
                                <div class="product-name">Monthly Plan</div>
                                <div class="product-desc">Unlimited swaps for 30 days</div>
                            </div>
                            <div class="product-price">
                                XOF 11,750
                                <span class="product-price-period">/month</span>
                            </div>
                        </div>

                        <div class="product-card" onclick="selectPlan(this, 'payperswap')">
                            <div class="product-radio"></div>
                            <div class="product-info">
                                <div class="product-name">Pay-Per-Swap</div>
                                <div class="product-desc">Pay only when you swap</div>
                            </div>
                            <div class="product-price">
                                XOF 0
                                <span class="product-price-period">deposit</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screen 4: Confirm Payment -->
                <div class="screen" id="sales-screen-payment">
                    <div class="cost-card" style="margin-bottom: 8px;">
                        <div class="cost-item">
                            <span class="cost-label" id="sales-product-label">Oves E-Bike</span>
                            <span class="cost-value" id="sales-product-price">XOF 400,000</span>
                        </div>
                        <div class="cost-item">
                            <span class="cost-label" id="sales-plan-label">Weekly Plan</span>
                            <span class="cost-value" id="sales-plan-price">XOF 3,760</span>
                        </div>
                        <div class="cost-total" style="margin-top: 8px;">
                            <span class="cost-total-label">Total Amount</span>
                            <span class="cost-total-value" id="sales-payment-amount">XOF 403,760</span>
                        </div>
                    </div>

                    <div class="payment-scan">
                        <h2 class="payment-title">Confirm Payment</h2>
                        
                        <!-- Toggle between Scan and Manual -->
                        <div class="input-toggle">
                            <button class="toggle-btn active" id="toggle-sales-payment-scan" onclick="toggleSalesPaymentInput('scan')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"/>
                                    <rect x="14" y="3" width="7" height="7"/>
                                    <rect x="14" y="14" width="7" height="7"/>
                                    <rect x="3" y="14" width="7" height="7"/>
                                </svg>
                                Scan QR
                            </button>
                            <button class="toggle-btn" id="toggle-sales-payment-manual" onclick="toggleSalesPaymentInput('manual')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                </svg>
                                Enter ID
                            </button>
                        </div>
                        
                        <!-- Scan QR Option -->
                        <div class="payment-input-mode" id="sales-payment-scan-mode">
                            <p class="payment-subtitle">Scan customer's QR after payment</p>
                            
                            <div class="qr-scanner-area" onclick="salesConfirmPayment()">
                                <div class="qr-scanner-frame">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="7" height="7"/>
                                        <rect x="14" y="3" width="7" height="7"/>
                                        <rect x="14" y="14" width="7" height="7"/>
                                        <rect x="3" y="14" width="7" height="7"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="payment-amount" id="sales-payment-display">XOF 3,760</div>
                            <div class="payment-status">Tap to scan customer QR</div>
                        </div>
                        
                        <!-- Manual Entry Option -->
                        <div class="payment-input-mode hidden" id="sales-payment-manual-mode">
                            <p class="payment-subtitle">Enter payment transaction ID</p>
                            
                            <div class="manual-entry-form">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label class="form-label">Payment / Transaction ID</label>
                                    <input type="text" class="form-input manual-id-input" id="salesPaymentId" placeholder="e.g. TXN-892741 or M-PESA code" autocomplete="off">
                                </div>
                                <button class="btn btn-primary" onclick="salesLookupPayment()" style="width: 100%; margin-top: 8px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 6L9 17l-5-5"/>
                                    </svg>
                                    Confirm Payment
                                </button>
                            </div>
                            
                            <div class="payment-amount" style="margin-top: 8px;" id="sales-payment-display-manual">XOF 3,760</div>
                            <p class="scan-hint" style="margin-top: 4px;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                Enter M-PESA code or receipt number
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Screen 5: Assign Battery -->
                <div class="screen" id="sales-screen-battery">
                    <h2 class="scan-title" style="text-align: center; margin-bottom: 4px;">Assign Battery</h2>
                    <p class="scan-subtitle" style="text-align: center; margin-bottom: 10px;">Scan a battery to assign to customer</p>

                    <!-- Customer Preview -->
                    <div class="preview-card">
                        <div class="preview-header">
                            <div class="preview-avatar" id="sales-avatar">AC</div>
                            <div>
                                <div class="preview-name" id="sales-customer-name">ABC Customer Ltd</div>
                                <div class="preview-phone" id="sales-customer-phone">+254712345678</div>
                            </div>
                            <span class="preview-badge" id="sales-plan-badge">Weekly Plan</span>
                        </div>
                        <div class="preview-details">
                            <div class="detail-item">
                                <div class="detail-label">Email</div>
                                <div class="detail-value" id="sales-email">customer@example.com</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Location</div>
                                <div class="detail-value" id="sales-location">Nairobi, 00100</div>
                            </div>
                        </div>
                    </div>

                    <!-- Battery Scanner -->
                    <div class="scanner-area" onclick="salesSimulateBatteryScan()" style="width: 140px; height: 140px; margin: 10px auto;">
                        <div class="scanner-frame">
                            <div class="scanner-corners" style="inset: 12px;">
                                <div class="scanner-corner-bl"></div>
                                <div class="scanner-corner-br"></div>
                            </div>
                            <div class="scanner-line"></div>
                            <div class="scanner-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width: 36px; height: 36px;">
                                    <rect x="2" y="6" width="20" height="12" rx="2"/>
                                    <path d="M22 10v4"/>
                                    <path d="M6 10v4"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <p class="scan-hint">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01"/>
                        </svg>
                        Tap to scan battery barcode
                    </p>
                </div>

                <!-- Screen 6: Checkout/Success -->
                <div class="screen" id="sales-screen-checkout">
                    <div class="success-screen" style="padding-top: 30px;">
                        <div class="success-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <h2 class="success-title">Registration Complete!</h2>
                        <p class="success-message">Customer has been registered successfully</p>
                        
                        <!-- Checkout Summary -->
                        <div class="checkout-summary" style="text-align: left;">
                            <div class="receipt-header">
                                <span class="receipt-title">Registration Summary</span>
                                <span class="receipt-id" id="sales-reg-id">#REG-104782</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Customer</span>
                                <span class="checkout-item-value" id="checkout-name">ABC Customer Ltd</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Email</span>
                                <span class="checkout-item-value" id="checkout-email">customer@example.com</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Phone</span>
                                <span class="checkout-item-value" id="checkout-phone">+254712345678</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Address</span>
                                <span class="checkout-item-value" id="checkout-address">Nairobi, 00100</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Vehicle</span>
                                <span class="checkout-item-value" id="checkout-product">Oves E-Bike</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Battery Plan</span>
                                <span class="checkout-item-value" id="checkout-plan">Weekly Plan</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Battery Assigned</span>
                                <span class="checkout-item-value" id="checkout-battery">BAT-2024-1156</span>
                            </div>
                            <div class="checkout-item">
                                <span class="checkout-item-label">Battery Charge</span>
                                <span class="checkout-item-value" style="color: var(--success);">100%</span>
                            </div>
                            <div class="checkout-total">
                                <span class="checkout-total-label">Amount Paid</span>
                                <span class="checkout-total-value" id="checkout-amount">XOF 403,760</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Sales Rep Action Bar -->
            <div class="action-bar">
                <div class="action-bar-inner">
                    <button class="btn btn-secondary hidden" id="sales-btn-back" onclick="salesGoBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Back
                    </button>
                    <button class="btn btn-primary" id="sales-btn-main" onclick="salesHandleMainAction()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="sales-btn-icon">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                        <span id="sales-btn-text">Continue</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== -->
        <!-- RIDER MODULE         -->
        <!-- ==================== -->
        <div class="module" id="module-rider">
            <!-- Back to Roles - At very top -->
            <div class="back-to-roles" onclick="backToRoles()" style="margin: 0 16px 8px;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Change Role
            </div>

            <main class="main">
                <!-- Screen 1: Home/Dashboard -->
                <div class="rider-screen active" id="rider-screen-home">
                    <!-- Dashboard Header -->
                    <div class="rider-dashboard-header">
                        <div class="rider-greeting">Good afternoon,</div>
                        <div class="rider-name" id="rider-user-name">James Mwangi</div>
                    </div>

                    <!-- My Bike Card - Shows rider's vehicle -->
                    <div class="rider-bike-card">
                        <div class="rider-bike-header">
                            <div>
                                <div class="rider-bike-label">My Bike</div>
                                <div class="rider-bike-model" id="rider-bike-model">E-Trike 3X</div>
                            </div>
                            <span class="rider-bike-status active" id="rider-bike-status">Active</span>
                        </div>
                        <div class="rider-bike-content">
                            <div class="rider-bike-image">
                                <img src="assets/E-3-one.png" alt="My E-Trike">
                            </div>
                            <div class="rider-bike-info">
                                <div class="rider-bike-detail">
                                    <span class="rider-bike-detail-label">Vehicle ID</span>
                                    <span class="rider-bike-detail-value" id="rider-vehicle-id">VEH-2024-8847</span>
                                </div>
                                <div class="rider-bike-detail">
                                    <span class="rider-bike-detail-label">Last Swap</span>
                                    <span class="rider-bike-detail-value" id="rider-last-swap">2h ago</span>
                                </div>
                                <div class="rider-bike-detail">
                                    <span class="rider-bike-detail-label">Total Swaps</span>
                                    <span class="rider-bike-detail-value" id="rider-total-swaps">47</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Balance Card (shows money equivalent) -->
                    <div class="account-balance-card" id="rider-balance-card">
                        <div class="account-balance-info">
                            <div class="account-balance-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v12M8 10h8M8 14h8" stroke="var(--bg-primary)" stroke-width="2" fill="none"/>
                                </svg>
                            </div>
                            <div>
                                <div class="account-balance-label">Account Balance</div>
                                <div class="account-balance-value" id="rider-balance-value">XOF 3,100</div>
                            </div>
                        </div>
                        <button class="account-balance-action" onclick="riderShowTopUp()">Top Up</button>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <div class="quick-action" onclick="riderGoToScreen('map')">
                            <div class="quick-action-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                            </div>
                            <span class="quick-action-label">Find Station</span>
                        </div>
                        <div class="quick-action" onclick="riderShowQRCode()">
                            <div class="quick-action-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"/>
                                    <rect x="14" y="3" width="7" height="7"/>
                                    <rect x="14" y="14" width="7" height="7"/>
                                    <rect x="3" y="14" width="7" height="7"/>
                                </svg>
                            </div>
                            <span class="quick-action-label">My QR Code</span>
                        </div>
                    </div>

                    <!-- Nearby Stations Section -->
                    <div class="rider-section-header">
                        <span class="rider-section-title">Nearby Stations</span>
                        <span class="rider-section-link" onclick="riderGoToScreen('map')">View Map</span>
                    </div>
                    
                    <div class="stations-map-container">
                        <!-- Simulated Map -->
                        <div class="stations-map">
                            <div class="map-visual">
                                <div class="map-grid"></div>
                                <!-- User Location -->
                                <div class="map-user-pulse"></div>
                                <div class="map-user-marker"></div>
                                <!-- Station Pins -->
                                <div class="map-station-pin" style="top: 25%; left: 30%;" onclick="riderSelectStation(0)">
                                    <div class="map-station-icon">
                                        <svg viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                        </svg>
                                    </div>
                                    <span class="map-station-label">Lome Central</span>
                                </div>
                                <div class="map-station-pin" style="top: 60%; left: 70%;" onclick="riderSelectStation(1)">
                                    <div class="map-station-icon">
                                        <svg viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                        </svg>
                                    </div>
                                    <span class="map-station-label">Tokoin Market</span>
                                </div>
                                <div class="map-station-pin" style="top: 35%; left: 75%;" onclick="riderSelectStation(2)">
                                    <div class="map-station-icon">
                                        <svg viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                        </svg>
                                    </div>
                                    <span class="map-station-label">Agoe Station</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Station List -->
                        <div class="stations-list">
                            <div class="station-item" onclick="riderSelectStation(0)">
                                <div class="station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <div class="station-info">
                                    <div class="station-name">Lome Central Station</div>
                                    <div class="station-details">
                                        <span class="station-distance">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                                <circle cx="12" cy="10" r="3"/>
                                            </svg>
                                            0.8 km
                                        </span>
                                        <span class="station-availability">
                                            <span class="station-availability-dot"></span>
                                            12 batteries
                                        </span>
                                    </div>
                                </div>
                                <button class="station-nav-btn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="3 11 22 2 13 21 11 13 3 11"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="station-item" onclick="riderSelectStation(1)">
                                <div class="station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <div class="station-info">
                                    <div class="station-name">Tokoin Market Station</div>
                                    <div class="station-details">
                                        <span class="station-distance">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                                <circle cx="12" cy="10" r="3"/>
                                            </svg>
                                            1.4 km
                                        </span>
                                        <span class="station-availability">
                                            <span class="station-availability-dot low"></span>
                                            3 batteries
                                        </span>
                                    </div>
                                </div>
                                <button class="station-nav-btn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="3 11 22 2 13 21 11 13 3 11"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screen 2: Activity/History -->
                <div class="rider-screen" id="rider-screen-activity">
                    <h2 class="scan-title" style="margin-bottom: 4px;">Activity</h2>
                    <p class="scan-subtitle" style="margin-bottom: 16px;">Your swaps and payments</p>

                    <!-- Activity Filters -->
                    <div class="activity-filters">
                        <button class="activity-filter active" onclick="riderFilterActivity('all')">All</button>
                        <button class="activity-filter" onclick="riderFilterActivity('swaps')">Swaps</button>
                        <button class="activity-filter" onclick="riderFilterActivity('payments')">Payments</button>
                        <button class="activity-filter" onclick="riderFilterActivity('topups')">Top-ups</button>
                    </div>

                    <!-- Activity List -->
                    <div class="activity-list" id="rider-activity-list">
                        <div class="activity-date-header">Today</div>
                        
                        <div class="activity-item">
                            <div class="activity-item-icon swap">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M7 16V4m0 0L3 8m4-4l4 4M17 8v12m0 0l4-4m-4 4l-4-4"/>
                                </svg>
                            </div>
                            <div class="activity-item-content">
                                <div class="activity-item-title">Battery Swap</div>
                                <div class="activity-item-subtitle">Lome Central Station</div>
                            </div>
                            <div class="activity-item-meta">
                                <div class="activity-item-amount negative">-XOF 920</div>
                                <div class="activity-item-time">14:32</div>
                            </div>
                        </div>

                        <div class="activity-date-header">Yesterday</div>
                        
                        <div class="activity-item">
                            <div class="activity-item-icon topup">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                </svg>
                            </div>
                            <div class="activity-item-content">
                                <div class="activity-item-title">Balance Top-up</div>
                                <div class="activity-item-subtitle">Mobile Money - MTN</div>
                            </div>
                            <div class="activity-item-meta">
                                <div class="activity-item-amount positive">+XOF 5,000</div>
                                <div class="activity-item-time">09:15</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-item-icon swap">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M7 16V4m0 0L3 8m4-4l4 4M17 8v12m0 0l4-4m-4 4l-4-4"/>
                                </svg>
                            </div>
                            <div class="activity-item-content">
                                <div class="activity-item-title">Battery Swap</div>
                                <div class="activity-item-subtitle">Tokoin Market Station</div>
                            </div>
                            <div class="activity-item-meta">
                                <div class="activity-item-amount negative">-XOF 1,185</div>
                                <div class="activity-item-time">16:48</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-item-icon swap">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M7 16V4m0 0L3 8m4-4l4 4M17 8v12m0 0l4-4m-4 4l-4-4"/>
                                </svg>
                            </div>
                            <div class="activity-item-content">
                                <div class="activity-item-title">Battery Swap</div>
                                <div class="activity-item-subtitle">Agoe Station</div>
                            </div>
                            <div class="activity-item-meta">
                                <div class="activity-item-amount negative">-XOF 850</div>
                                <div class="activity-item-time">08:22</div>
                            </div>
                        </div>

                        <div class="activity-date-header">Dec 2, 2025</div>
                        
                        <div class="activity-item">
                            <div class="activity-item-icon payment">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="1" y="4" width="22" height="16" rx="2"/>
                                    <path d="M1 10h22"/>
                                </svg>
                            </div>
                            <div class="activity-item-content">
                                <div class="activity-item-title">Weekly Plan Renewal</div>
                                <div class="activity-item-subtitle">7-Day Lux Plan</div>
                            </div>
                            <div class="activity-item-meta">
                                <div class="activity-item-amount negative">XOF 3,760</div>
                                <div class="activity-item-time">00:00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screen 3: Full Map View -->
                <div class="rider-screen" id="rider-screen-map">
                    <h2 class="scan-title" style="margin-bottom: 4px;">Swap Stations</h2>
                    <p class="scan-subtitle" style="margin-bottom: 16px;">Find a station near you</p>

                    <div class="full-map-container">
                        <div class="map-visual">
                            <div class="map-grid"></div>
                            <!-- User Location -->
                            <div class="map-user-pulse"></div>
                            <div class="map-user-marker"></div>
                            <!-- Station Pins -->
                            <div class="map-station-pin" style="top: 20%; left: 25%;" onclick="riderSelectStation(0)">
                                <div class="map-station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <span class="map-station-label">Lome Central</span>
                            </div>
                            <div class="map-station-pin" style="top: 65%; left: 60%;" onclick="riderSelectStation(1)">
                                <div class="map-station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <span class="map-station-label">Tokoin Market</span>
                            </div>
                            <div class="map-station-pin" style="top: 30%; left: 70%;" onclick="riderSelectStation(2)">
                                <div class="map-station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <span class="map-station-label">Agoe Station</span>
                            </div>
                            <div class="map-station-pin" style="top: 75%; left: 30%;" onclick="riderSelectStation(3)">
                                <div class="map-station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <span class="map-station-label">Be Station</span>
                            </div>
                            <div class="map-station-pin" style="top: 45%; left: 85%;" onclick="riderSelectStation(4)">
                                <div class="map-station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <span class="map-station-label">Adidogome</span>
                            </div>
                        </div>
                        
                        <!-- Selected Station Detail Card -->
                        <div class="station-detail-card" id="rider-station-detail" style="display: none;">
                            <div class="station-detail-header">
                                <div class="station-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                    </svg>
                                </div>
                                <div class="station-detail-info">
                                    <div class="station-detail-name" id="station-detail-name">Lome Central Station</div>
                                    <div class="station-detail-address" id="station-detail-address">Rue du Commerce, Lome</div>
                                </div>
                            </div>
                            <div class="station-detail-stats">
                                <div class="station-detail-stat">
                                    <div class="station-detail-stat-value" id="station-detail-distance">0.8 km</div>
                                    <div class="station-detail-stat-label">Distance</div>
                                </div>
                                <div class="station-detail-stat">
                                    <div class="station-detail-stat-value" id="station-detail-batteries">12</div>
                                    <div class="station-detail-stat-label">Batteries</div>
                                </div>
                                <div class="station-detail-stat">
                                    <div class="station-detail-stat-value" id="station-detail-wait">~3 min</div>
                                    <div class="station-detail-stat-label">Wait Time</div>
                                </div>
                            </div>
                            <div class="station-detail-actions">
                                <button class="btn btn-secondary" onclick="riderHideStationDetail()">
                                    Close
                                </button>
                                <button class="btn btn-primary" onclick="riderNavigateToStation()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="3 11 22 2 13 21 11 13 3 11"/>
                                    </svg>
                                    Navigate
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screen 4: Profile/Account -->
                <div class="rider-screen" id="rider-screen-profile">
                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-avatar" id="rider-profile-avatar">JM</div>
                        <div class="profile-name" id="rider-profile-name">James Mwangi</div>
                        <div class="profile-phone" id="rider-profile-phone">+228 91 234 567</div>
                    </div>

                    <!-- Energy Service Card -->
                    <div class="energy-service-card">
                        <div class="energy-service-header">
                            <div class="energy-service-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                </svg>
                            </div>
                            <div class="energy-service-title">
                                <span class="energy-service-name">Energy Service</span>
                                <span class="energy-service-status">
                                    <span class="status-dot"></span>
                                    Active
                                </span>
                            </div>
                        </div>
                        
                        <div class="energy-service-visual">
                            <img src="assets/E-3-one.png" alt="E-Trike" class="energy-service-bike">
                            <div class="energy-service-glow"></div>
                        </div>
                        
                        <div class="energy-service-stats">
                            <div class="energy-stat-card primary">
                                <div class="energy-stat-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 6v12M8 10h8M8 14h8"/>
                                    </svg>
                                </div>
                                <div class="energy-stat-info">
                                    <span class="energy-stat-value" id="rider-sub-balance">XOF 3,100</span>
                                    <span class="energy-stat-label">Account Balance</span>
                                </div>
                            </div>
                            <div class="energy-stat-card">
                                <div class="energy-stat-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M23 6l-9.5 9.5-5-5L1 18"/>
                                        <path d="M17 6h6v6"/>
                                    </svg>
                                </div>
                                <div class="energy-stat-info">
                                    <span class="energy-stat-value" id="rider-sub-swaps">18</span>
                                    <span class="energy-stat-label">Swaps This Month</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="energy-service-footer">
                            <span class="energy-plan-name">7-Day Lux Plan</span>
                            <span class="energy-plan-validity">Valid until Dec 9, 2025</span>
                        </div>
                    </div>

                    <!-- Menu List -->
                    <div class="menu-list">
                        <div class="menu-item" onclick="riderShowAccountDetails()">
                            <div class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-title">Account Details</div>
                                <div class="menu-item-subtitle">Personal information & settings</div>
                            </div>
                            <div class="menu-item-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                            </div>
                        </div>

                        <div class="menu-item" onclick="riderShowVehicle()">
                            <div class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="7" cy="17" r="2"/>
                                    <circle cx="17" cy="17" r="2"/>
                                    <path d="M5 17H3v-6l2-4h9l4 4h3v6h-2"/>
                                    <path d="M9 17h6"/>
                                </svg>
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-title">My Vehicle</div>
                                <div class="menu-item-subtitle">Oves Tuk-Tuk • REG-2024-KE</div>
                            </div>
                            <div class="menu-item-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                            </div>
                        </div>

                        <div class="menu-item" onclick="riderShowPlanDetails()">
                            <div class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <path d="M14 2v6h6"/>
                                    <path d="M16 13H8M16 17H8M10 9H8"/>
                                </svg>
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-title">Subscription Plan</div>
                                <div class="menu-item-subtitle">Manage your plan & billing</div>
                            </div>
                            <div class="menu-item-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                            </div>
                        </div>

                        <div class="menu-item" onclick="riderShowPaymentMethods()">
                            <div class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="1" y="4" width="22" height="16" rx="2"/>
                                    <path d="M1 10h22"/>
                                </svg>
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-title">Payment Methods</div>
                                <div class="menu-item-subtitle">MTN Mobile Money</div>
                            </div>
                            <div class="menu-item-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                            </div>
                        </div>

                        <div class="menu-item" onclick="riderShowSupport()">
                            <div class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                    <path d="M12 17h.01"/>
                                </svg>
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-title">Help & Support</div>
                                <div class="menu-item-subtitle">FAQs, contact support</div>
                            </div>
                            <div class="menu-item-arrow">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="menu-list">
                        <div class="menu-item logout" onclick="riderLogout()">
                            <div class="menu-item-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                    <polyline points="16 17 21 12 16 7"/>
                                    <line x1="21" y1="12" x2="9" y2="12"/>
                                </svg>
                            </div>
                            <div class="menu-item-content">
                                <div class="menu-item-title">Log Out</div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Bottom Navigation Bar -->
            <nav class="rider-nav">
                <button class="rider-nav-item active" onclick="riderGoToScreen('home')" id="rider-nav-home">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                    <span class="rider-nav-label">Home</span>
                </button>
                <button class="rider-nav-item" onclick="riderGoToScreen('map')" id="rider-nav-map">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    <span class="rider-nav-label">Stations</span>
                </button>
                <button class="rider-nav-item" onclick="riderGoToScreen('activity')" id="rider-nav-activity">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span class="rider-nav-label">Activity</span>
                </button>
                <button class="rider-nav-item" onclick="riderGoToScreen('profile')" id="rider-nav-profile">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span class="rider-nav-label">Profile</span>
                </button>
            </nav>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Processing...</div>
        </div>

        <!-- Session Search Modal -->
        <div class="session-modal" id="session-modal" onclick="if(event.target === this) closeSessionModal()">
            <div class="session-modal-content">
                <div class="session-modal-header">
                    <h3 class="session-modal-title">Session History</h3>
                    <button class="session-modal-close" onclick="closeSessionModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="session-modal-body">
                    <div class="session-search-input-wrapper">
                        <input type="text" class="session-search-input" id="session-search-input" placeholder="Enter Subscription ID..." oninput="filterSessions()">
                        <button class="session-search-submit" onclick="searchSessions()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="session-filters" id="session-filters">
                        <button class="session-filter-btn active" data-filter="all" onclick="setSessionFilter('all')">All</button>
                        <button class="session-filter-btn" data-filter="in-progress" onclick="setSessionFilter('in-progress')">In Progress</button>
                        <button class="session-filter-btn" data-filter="completed" onclick="setSessionFilter('completed')">Completed</button>
                        <button class="session-filter-btn" data-filter="paused" onclick="setSessionFilter('paused')">Paused</button>
                    </div>
                    
                    <div class="session-list" id="session-list">
                        <!-- Sessions will be populated here -->
                        <div class="session-list-empty" id="session-list-empty">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10 9 9 9 8 9"/>
                            </svg>
                            <p>No sessions found</p>
                            <span style="font-size: 11px; margin-top: 4px;">Search by subscription ID to find customer sessions</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Session Recovery Prompt -->
        <div class="session-recovery-prompt" id="session-recovery-prompt">
            <div class="session-recovery-header">
                <div class="session-recovery-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                </div>
                <div class="session-recovery-text">
                    <h4>Resume Previous Session?</h4>
                    <p id="session-recovery-info">You have an incomplete session for customer <strong id="recovery-customer-id">CUS-8847-KE</strong> at step <strong id="recovery-step">3</strong> of 6.</p>
                </div>
            </div>
            <div class="session-recovery-actions">
                <button class="session-recovery-btn secondary" onclick="dismissSessionRecovery(true)">Start Fresh</button>
                <button class="session-recovery-btn primary" onclick="resumeSession()">Resume Session</button>
            </div>
        </div>

        <!-- QR Code Modal for Rider -->
        <div class="qr-modal-overlay" id="qr-modal" onclick="if(event.target === this) closeQRModal()">
            <div class="qr-modal">
                <div class="qr-modal-header">
                    <h3 class="qr-modal-title">Payment QR Code</h3>
                    <button class="qr-modal-close" onclick="closeQRModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="qr-modal-body">
                    <!-- Input Section -->
                    <div class="qr-input-section" id="qr-input-section">
                        <p class="qr-modal-desc">Enter your payment transaction ID from MTN Mobile Money, Flooz, or bank transfer to generate a QR code for the attendant.</p>
                        
                        <div class="qr-input-group">
                            <label class="qr-input-label">Transaction ID</label>
                            <input type="text" class="qr-input" id="qr-transaction-id" placeholder="e.g. TXN-892741 or M-PESA code" autocomplete="off">
                        </div>
                        
                        <button class="qr-generate-btn" onclick="generateTransactionQR()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                            </svg>
                            Generate QR Code
                        </button>
                    </div>
                    
                    <!-- QR Display Section (hidden initially) -->
                    <div class="qr-display-section hidden" id="qr-display-section">
                        <div class="qr-code-container" id="qr-code-display">
                            <!-- QR code will be generated here -->
                        </div>
                        <div class="qr-transaction-info">
                            <span class="qr-transaction-label">Transaction ID:</span>
                            <span class="qr-transaction-value" id="qr-transaction-display">-</span>
                        </div>
                        <p class="qr-instruction">Show this QR code to the swap attendant to verify your payment.</p>
                        
                        <button class="qr-new-btn" onclick="resetQRModal()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 4v6h6M23 20v-6h-6"/>
                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                            </svg>
                            Enter New Transaction
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top-Up Flow Modal -->
        <div class="topup-modal-overlay" id="topup-modal" onclick="if(event.target === this) closeTopUpModal()">
            <div class="topup-modal">
                <div class="topup-modal-header">
                    <h3 class="topup-modal-title" id="topup-modal-title">Top Up Account</h3>
                    <button class="topup-modal-close" onclick="closeTopUpModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="topup-modal-body">
                    <!-- Progress Indicator -->
                    <div class="topup-progress">
                        <div class="topup-step-dot active" id="topup-dot-1"></div>
                        <div class="topup-step-dot" id="topup-dot-2"></div>
                        <div class="topup-step-dot" id="topup-dot-3"></div>
                    </div>
                    
                    <!-- Step 1: Select Amount & View Payment Details -->
                    <div class="topup-step active" id="topup-step-1">
                        <h4 class="topup-step-title">Select Amount</h4>
                        <p class="topup-step-desc">Choose how much you want to top up</p>
                        
                        <div class="topup-amount-selector">
                            <button class="topup-amount-btn" onclick="selectTopUpAmount(1000)">XOF 1,000</button>
                            <button class="topup-amount-btn selected" onclick="selectTopUpAmount(2000)">XOF 2,000</button>
                            <button class="topup-amount-btn" onclick="selectTopUpAmount(5000)">XOF 5,000</button>
                            <button class="topup-amount-btn" onclick="selectTopUpAmount(10000)">XOF 10,000</button>
                            <button class="topup-amount-btn" onclick="selectTopUpAmount(20000)">XOF 20,000</button>
                            <button class="topup-amount-btn" onclick="selectTopUpAmount(0)">Custom</button>
                        </div>
                        
                        <div class="topup-custom-amount hidden" id="topup-custom-input">
                            <input type="number" placeholder="Enter amount in XOF" id="topup-custom-amount" oninput="updateCustomAmount()">
                        </div>
                        
                        <h4 class="topup-step-title" style="margin-top: 24px;">Payment Details</h4>
                        <p class="topup-step-desc">Send payment to any of these accounts</p>
                        
                        <!-- MTN Mobile Money -->
                        <div class="payment-details-card">
                            <div class="payment-method-header">
                                <div class="payment-method-icon mtn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                                        <path d="M12 18h.01"/>
                                    </svg>
                                </div>
                                <div class="payment-method-info">
                                    <h4>MTN Mobile Money</h4>
                                    <p>Instant transfer</p>
                                </div>
                            </div>
                            <div class="payment-detail-row">
                                <span class="payment-detail-label">Phone Number</span>
                                <span class="payment-detail-value">
                                    +228 90 123 456
                                    <button class="copy-btn" onclick="copyToClipboard('+22890123456', this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                        </svg>
                                    </button>
                                </span>
                            </div>
                            <div class="payment-detail-row">
                                <span class="payment-detail-label">Account Name</span>
                                <span class="payment-detail-value">OVES Energy Ltd</span>
                            </div>
                        </div>
                        
                        <!-- Flooz -->
                        <div class="payment-details-card">
                            <div class="payment-method-header">
                                <div class="payment-method-icon flooz">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                                        <path d="M12 18h.01"/>
                                    </svg>
                                </div>
                                <div class="payment-method-info">
                                    <h4>Flooz (Moov)</h4>
                                    <p>Instant transfer</p>
                                </div>
                            </div>
                            <div class="payment-detail-row">
                                <span class="payment-detail-label">Phone Number</span>
                                <span class="payment-detail-value">
                                    +228 97 654 321
                                    <button class="copy-btn" onclick="copyToClipboard('+22897654321', this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                        </svg>
                                    </button>
                                </span>
                            </div>
                            <div class="payment-detail-row">
                                <span class="payment-detail-label">Account Name</span>
                                <span class="payment-detail-value">OVES Energy Ltd</span>
                            </div>
                        </div>
                        
                        <!-- Bank Transfer -->
                        <div class="payment-details-card">
                            <div class="payment-method-header">
                                <div class="payment-method-icon bank">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 21h18M3 10h18M5 6l7-3 7 3M4 10v11M20 10v11M8 14v3M12 14v3M16 14v3"/>
                                    </svg>
                                </div>
                                <div class="payment-method-info">
                                    <h4>Bank Transfer</h4>
                                    <p>1-2 business days</p>
                                </div>
                            </div>
                            <div class="payment-detail-row">
                                <span class="payment-detail-label">Bank Name</span>
                                <span class="payment-detail-value">Ecobank Togo</span>
                            </div>
                            <div class="payment-detail-row">
                                <span class="payment-detail-label">Account Number</span>
                                <span class="payment-detail-value">
                                    0051234567890
                                    <button class="copy-btn" onclick="copyToClipboard('0051234567890', this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                        </svg>
                                    </button>
                                </span>
                            </div>
                            <div class="payment-detail-row">
                                <span class="payment-detail-label">Account Name</span>
                                <span class="payment-detail-value">OVES Energy Ltd</span>
                            </div>
                        </div>
                        
                        <div class="payment-instructions">
                            <h5>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                How to pay
                            </h5>
                            <ol>
                                <li>Send the exact amount to one of the accounts above</li>
                                <li>Note down your transaction/reference ID</li>
                                <li>Click "I've Made Payment" below to confirm</li>
                            </ol>
                        </div>
                        
                        <div class="topup-actions">
                            <button class="topup-btn topup-btn-secondary" onclick="closeTopUpModal()">Cancel</button>
                            <button class="topup-btn topup-btn-primary" onclick="goToTopUpStep(2)">
                                I've Made Payment
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M5 12h14M12 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Enter Transaction ID & Confirm -->
                    <div class="topup-step" id="topup-step-2">
                        <h4 class="topup-step-title">Confirm Payment</h4>
                        <p class="topup-step-desc">Enter your payment details to verify</p>
                        
                        <div class="topup-summary">
                            <div class="topup-summary-row">
                                <span class="topup-summary-label">Top-up Amount</span>
                                <span class="topup-summary-value" id="topup-confirm-amount">XOF 2,000</span>
                            </div>
                            <div class="topup-summary-row total">
                                <span class="topup-summary-label">You're adding</span>
                                <span class="topup-summary-value" id="topup-confirm-total">XOF 2,000</span>
                            </div>
                        </div>
                        
                        <div class="topup-input-group">
                            <label class="topup-input-label">Transaction ID / Reference</label>
                            <input type="text" class="topup-input" id="topup-transaction-id" placeholder="e.g. TXN-892741 or M-PESA code">
                        </div>
                        
                        <div class="topup-input-group">
                            <label class="topup-input-label">Payment Method Used</label>
                            <select class="topup-input" id="topup-payment-method" style="font-family: 'Outfit', sans-serif;">
                                <option value="">Select payment method</option>
                                <option value="mtn">MTN Mobile Money</option>
                                <option value="flooz">Flooz (Moov)</option>
                                <option value="bank">Bank Transfer</option>
                            </select>
                        </div>
                        
                        <div class="topup-confirm-check" onclick="toggleTopUpConfirm()">
                            <input type="checkbox" id="topup-confirm-checkbox">
                            <label for="topup-confirm-checkbox">I confirm that I have sent <strong id="topup-confirm-label-amount">XOF 2,000</strong> to the specified account and the transaction ID above is correct.</label>
                        </div>
                        
                        <div class="topup-actions">
                            <button class="topup-btn topup-btn-secondary" onclick="goToTopUpStep(1)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                                </svg>
                                Back
                            </button>
                            <button class="topup-btn topup-btn-primary" id="topup-confirm-btn" onclick="confirmTopUp()" disabled>
                                Confirm Top-Up
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Success -->
                    <div class="topup-step" id="topup-step-3">
                        <div class="topup-success">
                            <div class="topup-success-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <h4 class="topup-success-title">Top-Up Successful!</h4>
                            <div class="topup-success-amount" id="topup-success-amount">+XOF 2,000</div>
                            <p class="topup-success-desc">Your account has been credited successfully</p>
                            
                            <div class="topup-new-balance">
                                <div class="topup-new-balance-label">New Account Balance</div>
                                <div class="topup-new-balance-value" id="topup-new-balance">XOF 5,100</div>
                            </div>
                            
                            <button class="topup-done-btn" onclick="finishTopUp()">Done</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Core Scripts -->
    <script src="js/app.js"></script>
    
    <!-- Module Scripts -->
    <script src="js/modules/session.js"></script>
    <script src="js/modules/attendant.js"></script>
    <script src="js/modules/sales.js"></script>
    <script src="js/modules/rider.js"></script>
    
    <!-- Initialize App -->
    <script>
        // Start the app
        document.addEventListener('DOMContentLoaded', function() {
            checkSplash();
        });
    </script>
</body>
</html>
